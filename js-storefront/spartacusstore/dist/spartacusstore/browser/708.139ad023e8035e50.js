"use strict";(self.webpackChunkstorefrontapp=self.webpackChunkstorefrontapp||[]).push([[708],{5708:(te,y,s)=>{s.r(y),s.d(y,{CdcModule:()=>q});var e=s(4650),g=s(6895),c=s(1742),L=s(5778),T=s(2994),v=s(2986),U=s(9764),l=s(2700);function F(t,o){if(1&t&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&t){const n=e.oxw().ngIf,i=e.oxw(2).ngIf,r=e.oxw();e.uIk("id",i.containerID),e.xp6(1),e.hij(" ",r.displayScreenSet(i,n)," ")}}function R(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"a",4),e.NdJ("click",function(){e.CHM(n);const r=e.oxw().ngIf,d=e.oxw(2).ngIf,a=e.oxw();return e.KtG(a.showScreenSet(d,r))}),e._uU(1),e.qZA()}if(2&t){const n=e.oxw(3).ngIf;e.uIk("data-cdc-id",n.uid)("data-profile-edit",n.profileEdit),e.xp6(1),e.Oqu(n.linkText)}}function G(t,o){if(1&t&&(e.TgZ(0,"div"),e.YNc(1,F,2,2,"div",2),e.YNc(2,R,2,3,"ng-template",null,3,e.W1O),e.qZA()),2&t){const n=e.MAs(3),i=e.oxw(2).ngIf,r=e.oxw();e.xp6(1),e.Q6J("ngIf",r.displayInEmbedMode(i))("ngIfElse",n)}}function _(t,o){if(1&t&&(e.TgZ(0,"div"),e.YNc(1,G,4,2,"div",0),e.ALo(2,"async"),e.qZA()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,n.language$))}}function k(t,o){1&t&&(e.TgZ(0,"div",5),e._uU(1),e.ALo(2,"cxTranslate"),e.ALo(3,"cxTranslate"),e.qZA()),2&t&&(e.xp6(1),e.AsE(" ",e.lcZ(2,2,"errorHandlers.scriptFailedToLoad")," ",e.lcZ(3,4,"errorHandlers.refreshThePage")," "))}function w(t,o){if(1&t&&(e.TgZ(0,"div"),e.YNc(1,_,3,3,"div",0),e.ALo(2,"async"),e.YNc(3,k,4,6,"div",1),e.ALo(4,"async"),e.qZA()),2&t){const n=e.oxw();e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,n.jsLoaded$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,4,n.jsError$))}}let Y=(()=>{class t{constructor(n,i,r,d,a,u,m){this.component=n,this.baseSiteService=i,this.languageService=r,this.cdcConfig=d,this.winRef=a,this.cdcJSService=u,this.zone=m,this.renderScreenSet=!0}ngOnInit(){this.jsLoaded$=this.cdcJSService.didLoad(),this.jsError$=this.cdcJSService.didScriptFailToLoad(),this.language$=this.languageService.getActive().pipe((0,L.x)(),(0,T.b)(()=>this.renderScreenSet=!0))}displayScreenSet(n,i){this.renderScreenSet&&this.showScreenSet(n,i),this.renderScreenSet=!1}showScreenSet(n,i){this.winRef.nativeWindow?.gigya?.accounts?.showScreenSet({screenSet:n.screenSet,startScreen:n.startScreen,lang:i,...this.displayInEmbedMode(n)?{containerID:n.containerID}:{},...this.isLoginScreenSet(n)?{sessionExpiration:this.getSessionExpirationValue()}:{onAfterSubmit:(...r)=>{this.zone.run(()=>this.cdcJSService.onProfileUpdateEventHandler(...r))}}})}isLoginScreenSet(n){return!("true"===n.profileEdit)}getSessionExpirationValue(){if(void 0!==this.cdcConfig?.cdc){const n=this.cdcConfig.cdc.filter(i=>i.baseSite===this.getCurrentBaseSite());if(n&&n.length>0)return n[0].sessionExpiration}return 3600}getCurrentBaseSite(){let n="";return this.baseSiteService.getActive().pipe((0,v.q)(1)).subscribe(i=>n=i),n}displayInEmbedMode(n){return!!("true"===n.embed&&n.containerID&&n.containerID.length>0)}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(U.exf),e.Y36(c.Do$),e.Y36(c.TSl),e.Y36(l.Y4),e.Y36(c.X9E),e.Y36(l.bF),e.Y36(e.R0b))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cx-gigya-raas"]],decls:2,vars:3,consts:[[4,"ngIf"],["class","js-error",4,"ngIf"],[4,"ngIf","ngIfElse"],["popupLink",""],[1,"popup-link",3,"click"],[1,"js-error"]],template:function(n,i){1&n&&(e.YNc(0,w,5,6,"div",0),e.ALo(1,"async")),2&n&&e.Q6J("ngIf",e.lcZ(1,1,i.component.data$))},dependencies:[g.O5,g.Ov,c.X$D],styles:["cx-gigya-raas .popup-link{cursor:pointer;color:var(--cx-color-primary)}cx-gigya-raas .js-error{text-align:center;padding:4rem}\n"],encapsulation:2,changeDetection:0}),t})(),O=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[g.ez,c.LUR,c.pEA.withConfig({cmsComponents:{GigyaRaasComponent:{component:Y}},layoutSlots:{GigyaLoginPageTemplate:{slots:["BodyContent","BottomContent"]}}})]}),t})(),j=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[g.ez,O]}),t})();var M=s(529),J=s(1737),A=s(1086),Z=s(6053),B=s(8896),x=s(7221),p=s(4850),z=s(1709),$=s(7545),f=s(5024),N=s(8353),b=s(8555);let I=(()=>{class t{constructor(n,i){this.http=n,this.authConfigService=i}loadTokenUsingCustomFlow(n,i,r,d,a){const u=this.authConfigService.getTokenEndpoint(),m=(new M.LE).set("client_id",this.authConfigService.getClientId()).set("client_secret",this.authConfigService.getClientSecret()).set("grant_type","custom").set("UID",encodeURIComponent(n)).set("UIDSignature",encodeURIComponent(i)).set("signatureTimestamp",encodeURIComponent(r)).set("id_token",encodeURIComponent(d)).set("baseSite",encodeURIComponent(a));return this.http.post(u,m).pipe((0,x.K)(ee=>(0,J._)(ee)))}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(M.eN),e.LFG(c.dSP))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})();const h="[Auth] Load CDC User Token",S="[Auth] Load CDC User Token Fail";class E{constructor(o){this.payload=o,this.type=S}}class D{constructor(o){this.payload=o,this.type=h}}let C=(()=>{class t{constructor(n,i,r,d,a){this.store=n,this.authStorageService=i,this.userIdService=r,this.globalMessageService=d,this.authRedirectService=a}loginWithCustomCdcFlow(n,i,r,d,a){this.store.dispatch(new D({UID:n,UIDSignature:i,signatureTimestamp:r,idToken:d,baseSite:a}))}isAsmAuthStorageService(n){return"getTokenTarget"in n}loginWithToken(n){let i=(0,A.of)(!0);this.isAsmAuthStorageService(this.authStorageService)&&(i=(0,Z.aj)([this.authStorageService.getToken(),this.authStorageService.getTokenTarget()]).pipe((0,v.q)(1),(0,p.U)(([r,d])=>!!r?.access_token&&d===N.gt.CSAgent),(0,T.b)(r=>{r&&this.globalMessageService.add({key:"asm.auth.agentLoggedInError"},c.xUg.MSG_TYPE_ERROR)}),(0,p.U)(r=>!r))),i.pipe((0,v.q)(1)).subscribe(r=>{if(r){if(this.authStorageService.setItem("access_token",n.access_token),n.granted_scopes&&Array.isArray(n.granted_scopes)&&this.authStorageService.setItem("granted_scopes",JSON.stringify(n.granted_scopes)),this.authStorageService.setItem("access_token_stored_at",""+Date.now()),n.expires_in){const d=1e3*n.expires_in,u=(new Date).getTime()+d;this.authStorageService.setItem("expires_at",""+u)}n.refresh_token&&this.authStorageService.setItem("refresh_token",n.refresh_token),this.userIdService.setUserId(c.zyp),this.store.dispatch(new c.uQL.Login),this.globalMessageService.remove(c.xUg.MSG_TYPE_ERROR),this.authRedirectService.redirect()}})}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(b.yh),e.LFG(c.jg0),e.LFG(c.XBV),e.LFG(c.IWp),e.LFG(c.FUY))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})(),P=(()=>{class t{constructor(n,i,r,d){this.actions$=n,this.userTokenService=i,this.globalMessageService=r,this.cdcAuthService=d,this.loadCdcUserToken$=(0,f.GW)(()=>this.actions$.pipe((0,f.l4)(h),(0,p.U)(a=>a.payload),(0,z.zg)(a=>this.userTokenService.loadTokenUsingCustomFlow(a.UID,a.UIDSignature,a.signatureTimestamp,a.idToken,a.baseSite).pipe((0,$.w)(u=>(this.cdcAuthService.loginWithToken(u),B.E)),(0,x.K)(u=>(this.globalMessageService.add({key:"httpHandlers.badGateway"},c.xUg.MSG_TYPE_ERROR),(0,A.of)(new E({error:(0,c.cxH)(u),initialActionPayload:a}))))))))}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(f.eX),e.LFG(I),e.LFG(c.IWp),e.LFG(C))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})(),W=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[g.ez,f.sQ.forFeature([P])]}),t})(),K=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[I],imports:[g.ez,c.nyr,W]}),t})();const Q=[C,{provide:l.Wz,useExisting:C}];let H=(()=>{class t{constructor(n,i){this.stateEventService=n,this.eventService=i,this.register()}register(){this.registerLoadUserTokenFail()}registerLoadUserTokenFail(){this.stateEventService.register({action:S,event:l.yB})}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(c.vL$),e.LFG(c.POd))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),V=(()=>{class t{constructor(n){}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(H))},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({}),t})(),X=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[...Q],imports:[K,V]}),t})(),q=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[j,X]}),t})()}}]);